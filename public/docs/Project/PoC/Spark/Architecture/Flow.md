# 구조 개요

## 시스템 구성 요소

### 클라이언트 (A, B 프로젝트)

-   실시간 채팅 등 실시간 기능용 WebSocket 클라이언트 포함
-   채팅 메시지는 WebSocket을 통해 전송

### 백엔드 서버 (각 프로젝트별 A, B, C 서버)

-   REST API 및 WebSocket 엔드포인트 제공
-   WebSocket 연결 관리
-   채팅 메시지 송수신 처리

### API Gateway (재활용)

-   인증 토큰 검증, 요청 라우팅
-   WebSocket 요청 프록시 역할
-   로깅 서버와 연계해 요청 로깅

### Auth Server (재활용)

-   OAuth2 인증 및 토큰 발급/검증 담당
-   WebSocket 연결 시 토큰 인증 수행

### Redis (추가 요소)

-   **캐싱 계층**: 세션 정보, 빈번 사용되는 데이터 캐싱
-   **Pub/Sub 시스템**: 채팅 메시지, 실시간 이벤트를 발행/구독 처리
-   각 백엔드 서버는 Redis Pub/Sub로 메시지를 발행(Publish)하고, 다른 서버들은 이를 구독(Subscribe)하여 실시간 메시지 전달

### 로깅 서버 (재활용)

-   API Gateway 및 각 서버에서 발생하는 로그 수집 및 저장

## 메시지 흐름 예시 (채팅)

1. 클라이언트가 채팅 메시지를 WebSocket을 통해 백엔드 서버로 전송합니다.

2. 백엔드 서버는 받은 메시지를 Redis Pub/Sub 특정 채널에 발행합니다.

3. 동일 프로젝트 내 또는 다른 프로젝트의 관련 백엔드 서버들이 Redis 채널을 구독하고 메시지를 수신합니다.

4. 각 서버는 수신한 메시지를 WebSocket 연결 클라이언트로 전달합니다.

5. API Gateway는 초기 접속 인증 등 일부 WebSocket 제어 가능합니다.

이 구조는 MSA 환경에서 실시간 이벤트 처리와 느슨한 서비스 간 결합을 지원하며, Redis Pub/Sub가 메시지 브로커 역할을 하여 확장성과 신뢰성을 높여줍니다. Redis 캐싱은 응답 속도 향상과 부하 분산에 기여합니다.

## 요약

-   **실시간 기능**: 백엔드 서버가 WebSocket과 Redis Pub/Sub를 활용해 처리
-   **API Gateway**: WebSocket 요청 중계 및 인증 등 통합 관리
-   **Auth Server**: 인증 토큰 발급과 WebSocket 연결 인증 담당
-   **Redis**: 메시지 브로커 및 캐시로 실시간성과 성능 향상
